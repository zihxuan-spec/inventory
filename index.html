<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventory Management</title>
    <style>
        /* --- 核心配色 --- */
        :root {
            --theme-primary: #354a5f;
            --theme-bg: #edf0f4;
            --theme-surface: #ffffff;
            --theme-text: #32363a;
            --theme-label: #6a6d70;
            --theme-border: #d9d9d9;
            --theme-highlight: #0a6ed1;
            --theme-success: #107e3e;
            --theme-critical: #bb0000;
            --theme-warning: #e9730c;
            --font-family: "Segoe UI", "Roboto", "Helvetica Neue", sans-serif;
        }

        body { margin: 0; padding: 0; font-family: var(--font-family); background-color: var(--theme-bg); color: var(--theme-text); font-size: 14px; }

        /* --- Shell Bar --- */
        .shell-bar { background-color: var(--theme-primary); height: 48px; display: flex; justify-content: space-between; align-items: center; padding: 0 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.15); }
        .shell-title { color: white; font-weight: 600; font-size: 16px; letter-spacing: 0.5px; }
        .lang-switch { color: rgba(255,255,255,0.8); cursor: pointer; font-size: 13px; border: 1px solid rgba(255,255,255,0.4); padding: 4px 10px; border-radius: 4px; transition: all 0.2s; }
        .lang-switch:hover { color: white; border-color: white; background: rgba(255,255,255,0.1); }

        /* --- Page Layout --- */
        .page-header { background-color: var(--theme-surface); padding: 16px 32px; border-bottom: 1px solid var(--theme-border); display: flex; justify-content: space-between; align-items: center; }
        .page-title { font-size: 20px; font-weight: normal; color: var(--theme-text); }
        .subtitle { font-size: 12px; color: var(--theme-label); margin-top: 4px; }
        .content-area { padding: 20px 32px; max-width: 1200px; margin: 0 auto; }

        /* --- Toolbar --- */
        .toolbar { background: transparent; padding: 10px 0; display: flex; justify-content: space-between; align-items: center; gap: 10px; }
        .search-wrapper { flex-grow: 1; display: flex; justify-content: flex-end; }
        .std-input { padding: 8px 12px; border: 1px solid #89919a; border-radius: 4px; background: white; font-size: 14px; transition: border-color 0.2s; }
        .std-input:focus { outline: none; border-color: var(--theme-highlight); box-shadow: 0 0 0 2px rgba(10, 110, 209, 0.1); }
        .std-input[readonly] { background-color: #f4f4f4; color: #666; cursor: not-allowed; } /* Readonly style */
        .w-full { width: 100%; box-sizing: border-box; margin-bottom: 15px; }

        /* --- Table --- */
        .table-container { background: var(--theme-surface); border: 1px solid var(--theme-border); border-radius: 4px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        table { width: 100%; border-collapse: collapse; text-align: left; }
        thead { background-color: #f7f7f7; border-bottom: 1px solid var(--theme-border); }
        th { padding: 12px 16px; font-weight: 600; color: var(--theme-label); font-size: 12px; text-transform: uppercase; }
        td { padding: 12px 16px; border-bottom: 1px solid #eeeeee; vertical-align: middle; }
        tr:hover { background-color: #f5f7fa; cursor: pointer; }

        /* --- Status Dots --- */
        .status-dot { height: 10px; width: 10px; border-radius: 50%; display: inline-block; }
        .status-ok { background-color: var(--theme-success); }
        .status-low { background-color: var(--theme-warning); }
        .status-crit { background-color: var(--theme-critical); }

        /* --- Modals --- */
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.4); display: none; justify-content: center; align-items: center; z-index: 1000; }
        .std-dialog { background: white; width: 400px; border-radius: 6px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); display: flex; flex-direction: column; animation: fadeIn 0.2s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .dialog-header { background: #f4f6f8; padding: 12px 20px; border-bottom: 1px solid var(--theme-border); font-weight: 600; display: flex; justify-content: space-between; color: var(--theme-text); }
        .dialog-content { padding: 24px 20px; }
        .dialog-footer { padding: 12px 20px; border-top: 1px solid var(--theme-border); display: flex; justify-content: flex-end; gap: 10px; background: #fcfcfc; }
        .form-label { font-size: 12px; color: var(--theme-label); margin-bottom: 4px; display: block; font-weight: 600; }
        .input-hint { font-size: 11px; color: var(--theme-highlight); margin-bottom: 4px; display: block; text-align: right; }

        /* --- Buttons --- */
        .std-btn { border: 1px solid var(--theme-highlight); color: var(--theme-highlight); background: white; padding: 8px 16px; border-radius: 4px; font-size: 13px; font-weight: 600; cursor: pointer; min-width: 80px; }
        .std-btn:hover { background: #f0f8ff; }
        .std-btn-primary { background: var(--theme-highlight); color: white; }
        .std-btn-primary:hover { background: #0854a0; }
        .std-btn-danger { border-color: var(--theme-critical); color: var(--theme-critical); }
        .std-btn-danger:hover { background: #fff0f0; }
        .std-btn-transparent { border: 1px solid transparent; color: var(--theme-text); min-width: auto; }
        .std-btn-transparent:hover { background: #eaeaea; }

        .qty-control { display: flex; align-items: center; gap: 10px; margin-top: 10px; }
        .qty-input { width: 80px; text-align: right; font-weight: bold; }

        /* Toast */
        .toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: #32363a; color: white; padding: 12px 24px; border-radius: 4px; font-size: 13px; opacity: 0; transition: opacity 0.3s; pointer-events: none; }
    </style>
</head>
<body>

<div class="shell-bar">
    <div class="shell-title" data-i18n="app_title">Inventory Manager</div>
    <div class="lang-switch" onclick="toggleLanguage()">EN / 繁中</div>
</div>

<div class="page-header">
    <div>
        <div class="page-title" data-i18n="overview_title">Stock Overview</div>
        <div class="subtitle"><span data-i18n="location">Location</span>: Arizona Warehouse</div>
    </div>
    <div>
        <button class="std-btn std-btn-transparent" onclick="renderTable()" data-i18n="btn_refresh">Refresh</button>
    </div>
</div>

<div class="content-area">
    <div class="toolbar">
        <button class="std-btn std-btn-primary" onclick="openCreateModal()">
            <span style="font-size:14px; margin-right:5px;">+</span> <span data-i18n="btn_add_item">Add Item</span>
        </button>
        <div class="search-wrapper">
            <input type="text" id="searchInput" class="std-input" style="width: 250px;" placeholder="Search..." onkeyup="renderTable()">
        </div>
    </div>

    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th style="width: 50px;"></th>
                    <th style="width: 120px;" data-i18n="col_id">ID</th>
                    <th data-i18n="col_desc">Description</th>
                    <th style="text-align: right;" data-i18n="col_stock">Stock Level</th>
                    <th style="width: 80px;" data-i18n="col_unit">Unit</th>
                    <th style="width: 120px; text-align:center;" data-i18n="col_action">Action</th>
                </tr>
            </thead>
            <tbody id="inventoryBody"></tbody>
        </table>
    </div>
</div>

<div id="actionModal" class="modal-overlay">
    <div class="std-dialog">
        <div class="dialog-header">
            <span data-i18n="modal_title">Goods Movement</span>
            <span style="cursor:pointer;" onclick="closeModal('actionModal')">✕</span>
        </div>
        <div class="dialog-content">
            <div class="form-label" data-i18n="modal_material">Material</div>
            <div id="modalItemName" style="font-weight: 600; font-size: 16px; margin-bottom: 24px;">Item Name</div>
            <div class="form-label" data-i18n="modal_qty">Quantity</div>
            <div class="qty-control">
                <input type="number" id="qtyInput" class="std-input qty-input" value="1" min="1">
                <span id="modalUnit" style="font-weight:600; color: var(--theme-label);">PC</span>
            </div>
        </div>
        <div class="dialog-footer">
            <button class="std-btn std-btn-transparent" onclick="closeModal('actionModal')" data-i18n="btn_cancel">Cancel</button>
            <button class="std-btn std-btn-danger" onclick="confirmAction(-1)" data-i18n="btn_issue">Issue (-)</button>
            <button class="std-btn std-btn-primary" onclick="confirmAction(1)" data-i18n="btn_receive">Receive (+)</button>
        </div>
    </div>
</div>

<div id="createModal" class="modal-overlay">
    <div class="std-dialog">
        <div class="dialog-header">
            <span data-i18n="modal_create_title">Create New Item</span>
            <span style="cursor:pointer;" onclick="closeModal('createModal')">✕</span>
        </div>
        <div class="dialog-content">
            <div style="display:flex; justify-content:space-between;">
                <label class="form-label" data-i18n="col_id">ID</label>
                <span class="input-hint" data-i18n="hint_enter">Press Enter to lookup</span>
            </div>
            <input type="text" id="newId" class="std-input w-full" placeholder="e.g. T-800" onchange="autoFillMaterial()">

            <label class="form-label" data-i18n="col_desc">Description</label>
            <input type="text" id="newName" class="std-input w-full" placeholder="Auto-filled from Master Data">

            <div style="display: flex; gap: 10px;">
                <div style="flex: 1;">
                    <label class="form-label" data-i18n="col_stock">Initial Stock</label>
                    <input type="number" id="newStock" class="std-input w-full" value="0">
                </div>
                <div style="flex: 1;">
                    <label class="form-label" data-i18n="col_unit">Unit</label>
                    <input type="text" id="newUnit" class="std-input w-full" placeholder="Unit">
                </div>
            </div>
        </div>
        <div class="dialog-footer">
            <button class="std-btn std-btn-transparent" onclick="closeModal('createModal')" data-i18n="btn_cancel">Cancel</button>
            <button class="std-btn std-btn-primary" onclick="confirmCreate()" data-i18n="btn_create_confirm">Create</button>
        </div>
    </div>
</div>

<div id="toast" class="toast">Data Saved</div>

<script>
    // --- 0. Master Data (您的料表) ---
    // 在這裡定義您的所有料件資料庫
    const materialMaster = {
        "M-1001": { name: "AA Battery (3號電池)", unit: "PC" },
        "P-2044": { name: "A4 Paper (印表機紙)", unit: "BAG" },
        "S-3001": { name: "Ballpoint Pen Black", unit: "PC" },
        "T-800":  { name: "Terminator CPU (魔鬼終結者晶片)", unit: "PC" },
        "C-2077": { name: "Cyberdeck (網路監控臺)", unit: "SET" },
        "L-5500": { name: "LEGO Star Wars Set", unit: "BOX" },
        "F-101":  { name: "Fertilizer NPK 20-20-20", unit: "KG" }
    };

    // --- 1. Localization Config ---
    const translations = {
        en: {
            app_title: "Inventory Manager",
            overview_title: "Stock Overview",
            location: "Location",
            btn_refresh: "Refresh",
            btn_add_item: "Add Item",
            col_id: "ID",
            col_desc: "Description",
            col_stock: "Stock Level",
            col_unit: "Unit",
            col_action: "Action",
            manage: "Manage",
            modal_title: "Goods Movement",
            modal_create_title: "Create New Material",
            modal_material: "Material",
            modal_qty: "Quantity",
            btn_cancel: "Cancel",
            btn_issue: "Issue (-)",
            btn_receive: "Receive (+)",
            btn_create_confirm: "Create",
            msg_stock_deficit: "Error: Insufficient Stock",
            msg_success_in: "Goods Receipt Posted",
            msg_success_out: "Goods Issue Posted",
            msg_created: "Material Created Successfully",
            msg_incomplete: "Please fill in all fields",
            msg_found: "Material Data Found",
            msg_not_found: "Material Not Found in Master Data",
            placeholder_search: "Search ID or Name...",
            hint_enter: "Type ID & Enter to lookup"
        },
        zh: {
            app_title: "庫存管理系統",
            overview_title: "庫存總覽",
            location: "倉庫位置",
            btn_refresh: "重新整理",
            btn_add_item: "新增項目",
            col_id: "料號",
            col_desc: "備品名稱",
            col_stock: "庫存數量",
            col_unit: "單位",
            col_action: "操作",
            manage: "管理",
            modal_title: "貨物移動",
            modal_create_title: "新增備品資料",
            modal_material: "物料名稱",
            modal_qty: "異動數量",
            btn_cancel: "取消",
            btn_issue: "領料 (-)",
            btn_receive: "入庫 (+)",
            btn_create_confirm: "建立",
            msg_stock_deficit: "錯誤：庫存不足",
            msg_success_in: "入庫過帳成功",
            msg_success_out: "領用過帳成功",
            msg_created: "備品建立成功",
            msg_incomplete: "請填寫所有欄位",
            msg_found: "已帶入料表資料",
            msg_not_found: "查無此料號，請手動輸入",
            placeholder_search: "搜尋料號或名稱...",
            hint_enter: "輸入料號後按 Enter 帶入資料"
        }
    };

    let currentLang = 'en';

    function toggleLanguage() {
        currentLang = currentLang === 'en' ? 'zh' : 'en';
        updateTexts();
    }

    function updateTexts() {
        document.querySelectorAll('[data-i18n]').forEach(el => {
            const key = el.getAttribute('data-i18n');
            if (translations[currentLang][key]) {
                el.innerText = translations[currentLang][key];
            }
        });
        document.getElementById('searchInput').placeholder = translations[currentLang]['placeholder_search'];
        renderTable();
    }

    // --- 2. Current Inventory Data ---
    let inventoryData = [
        { id: "M-1001", name: "AA Battery (3號電池)", stock: 15, unit: "PC", minStock: 10 },
        { id: "P-2044", name: "A4 Paper (印表機紙)", stock: 3, unit: "BAG", minStock: 5 }
    ];

    let currentSelectedIndex = -1;

    // --- 3. UI Logic ---
    function renderTable() {
        const tbody = document.getElementById('inventoryBody');
        const searchTerm = document.getElementById('searchInput').value.toLowerCase();
        tbody.innerHTML = '';
        const manageText = translations[currentLang]['manage'];

        inventoryData.forEach((item, index) => {
            if (item.name.toLowerCase().includes(searchTerm) || item.id.toLowerCase().includes(searchTerm)) {
                let statusClass = 'status-ok';
                if (item.stock <= 0) statusClass = 'status-crit';
                else if (item.stock < item.minStock) statusClass = 'status-low';

                const tr = document.createElement('tr');
                tr.onclick = () => openActionModal(index);
                
                tr.innerHTML = `
                    <td><span class="status-dot ${statusClass}"></span></td>
                    <td style="font-family: monospace; font-size: 13px;">${item.id}</td>
                    <td style="font-weight: 500;">${item.name}</td>
                    <td style="text-align: right; font-weight: bold;">${item.stock}</td>
                    <td style="color: #666;">${item.unit}</td>
                    <td style="text-align: center;"><span style="font-size:12px; color: var(--theme-highlight); font-weight:600;">${manageText}</span></td>
                `;
                tbody.appendChild(tr);
            }
        });
    }

    // --- NEW: Auto Fill Logic ---
    function autoFillMaterial() {
        const idInput = document.getElementById('newId');
        const nameInput = document.getElementById('newName');
        const unitInput = document.getElementById('newUnit');
        
        const inputId = idInput.value.trim(); // Case sensitive mostly, or use .toUpperCase() if needed

        if(materialMaster[inputId]) {
            // Found
            nameInput.value = materialMaster[inputId].name;
            unitInput.value = materialMaster[inputId].unit;
            
            // Visual feedback
            nameInput.style.borderColor = "var(--theme-success)";
            setTimeout(() => nameInput.style.borderColor = "#89919a", 1000);
            showToast(translations[currentLang]['msg_found']);
        } else {
            // Not Found
            showToast(translations[currentLang]['msg_not_found'], true); // true for error color
            // Optional: clear fields or let user type manually
        }
    }

    // --- Modal Control ---
    function openActionModal(index) {
        currentSelectedIndex = index;
        const item = inventoryData[index];
        document.getElementById('modalItemName').innerText = `${item.id} - ${item.name}`;
        document.getElementById('modalUnit').innerText = item.unit;
        document.getElementById('qtyInput').value = 1;
        document.getElementById('actionModal').style.display = 'flex';
        setTimeout(() => document.getElementById('qtyInput').focus(), 100);
    }

    function openCreateModal() {
        document.getElementById('newId').value = '';
        document.getElementById('newName').value = '';
        document.getElementById('newStock').value = 0;
        document.getElementById('newUnit').value = '';
        document.getElementById('createModal').style.display = 'flex';
        setTimeout(() => document.getElementById('newId').focus(), 100);
    }

    function closeModal(modalId) {
        document.getElementById(modalId).style.display = 'none';
    }

    // --- Actions ---
    function confirmAction(direction) {
        const qty = parseInt(document.getElementById('qtyInput').value);
        if (qty <= 0 || isNaN(qty)) return;

        const item = inventoryData[currentSelectedIndex];
        
        if (direction === -1 && item.stock < qty) {
            showToast(translations[currentLang]['msg_stock_deficit'], true);
            return;
        }

        item.stock += (qty * direction);
        closeModal('actionModal');
        renderTable();
        showToast(direction === 1 ? translations[currentLang]['msg_success_in'] : translations[currentLang]['msg_success_out']);
    }

    function confirmCreate() {
        const id = document.getElementById('newId').value;
        const name = document.getElementById('newName').value;
        const stock = parseInt(document.getElementById('newStock').value);
        const unit = document.getElementById('newUnit').value;

        if(!id || !name || !unit) {
            showToast(translations[currentLang]['msg_incomplete'], true);
            return;
        }

        // Check if ID already exists in current inventory
        const exists = inventoryData.find(i => i.id === id);
        if(exists) {
            alert("This ID already exists in inventory list!");
            return;
        }

        const newItem = {
            id: id,
            name: name,
            stock: isNaN(stock) ? 0 : stock,
            unit: unit,
            minStock: 0
        };

        inventoryData.push(newItem);
        closeModal('createModal');
        renderTable();
        showToast(translations[currentLang]['msg_created']);
    }

    function showToast(message, isError = false) {
        const toast = document.getElementById('toast');
        toast.innerText = message;
        toast.style.opacity = 1;
        toast.style.backgroundColor = isError ? "#bb0000" : "#32363a";
        setTimeout(() => { toast.style.opacity = 0; }, 2000);
    }

    window.onclick = function(event) {
        if (event.target.classList.contains('modal-overlay')) {
            event.target.style.display = "none";
        }
    }

    updateTexts();
</script>

</body>
</html>
